<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜APIæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-section h2 {
            color: #667eea;
            margin-top: 0;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-left-color: #4CAF50;
            background-color: #f0f8f0;
        }
        .error {
            border-left-color: #f44336;
            background-color: #fdf0f0;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background-color: #4CAF50;
            color: white;
        }
        .status.error {
            background-color: #f44336;
            color: white;
        }
        .status.loading {
            background-color: #ff9800;
            color: white;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç®¡ç†å‘˜APIåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="grid">
            <!-- ç³»ç»Ÿç»Ÿè®¡æµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h2>
                <button onclick="testSystemStats()">æµ‹è¯•ç³»ç»Ÿç»Ÿè®¡</button>
                <button onclick="testUsageStats()">æµ‹è¯•ä½¿ç”¨ç»Ÿè®¡</button>
                <button onclick="testEfficiencyIndex()">æµ‹è¯•æ•ˆç‡æŒ‡æ•°</button>
                <div id="systemStatsResult" class="result" style="display:none;"></div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç†æµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
                <button onclick="testUserList()">æµ‹è¯•ç”¨æˆ·åˆ—è¡¨</button>
                <button onclick="testUserStats()">æµ‹è¯•ç”¨æˆ·ç»Ÿè®¡</button>
                <button onclick="testAddUser()">æµ‹è¯•æ·»åŠ ç”¨æˆ·</button>
                <div id="userResult" class="result" style="display:none;"></div>
            </div>

            <!-- èµ„æºç®¡ç†æµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ“ èµ„æºç®¡ç†</h2>
                <button onclick="testResourceList()">æµ‹è¯•èµ„æºåˆ—è¡¨</button>
                <button onclick="testResourceStats()">æµ‹è¯•èµ„æºç»Ÿè®¡</button>
                <button onclick="testCourseResources()">æµ‹è¯•è¯¾ç¨‹èµ„æº</button>
                <div id="resourceResult" class="result" style="display:none;"></div>
            </div>

            <!-- æˆç»©åˆ†ææµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ“ˆ æˆç»©åˆ†æ</h2>
                <button onclick="testGradeDistribution()">æµ‹è¯•æˆç»©åˆ†å¸ƒ</button>
                <button onclick="testErrorTopics()">æµ‹è¯•é”™è¯¯çŸ¥è¯†ç‚¹</button>
                <button onclick="testLearningTrends()">æµ‹è¯•å­¦ä¹ è¶‹åŠ¿</button>
                <div id="gradeResult" class="result" style="display:none;"></div>
            </div>

            <!-- ç³»ç»Ÿç›‘æ§æµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ–¥ï¸ ç³»ç»Ÿç›‘æ§</h2>
                <button onclick="testSystemStatus()">æµ‹è¯•ç³»ç»ŸçŠ¶æ€</button>
                <button onclick="testPerformanceMetrics()">æµ‹è¯•æ€§èƒ½æŒ‡æ ‡</button>
                <button onclick="testSystemInfo()">æµ‹è¯•ç³»ç»Ÿä¿¡æ¯</button>
                <div id="monitorResult" class="result" style="display:none;"></div>
            </div>

            <!-- ç»¼åˆæµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ”„ ç»¼åˆæµ‹è¯•</h2>
                <button onclick="testAllAPIs()">æµ‹è¯•æ‰€æœ‰API</button>
                <button onclick="clearAllResults()">æ¸…ç©ºç»“æœ</button>
                <div id="overallResult" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        // é€šç”¨è¯·æ±‚å‡½æ•°
        async function makeRequest(url, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                },
                mode: 'cors'
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(API_BASE + url, options);
                const result = await response.json();
                return { success: true, data: result, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, title, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            let statusClass = result.success ? 'success' : 'error';
            let statusText = result.success ? 'SUCCESS' : 'ERROR';
            
            element.innerHTML = `
                <strong>${title}</strong> 
                <span class="status ${statusClass}">${statusText}</span>
                <pre>${JSON.stringify(result, null, 2)}</pre>
            `;
            element.className = `result ${statusClass}`;
        }

        // ç³»ç»Ÿç»Ÿè®¡æµ‹è¯•
        async function testSystemStats() {
            const result = await makeRequest('/api/stats/system');
            showResult('systemStatsResult', 'ç³»ç»Ÿç»Ÿè®¡', result);
        }

        async function testUsageStats() {
            const result = await makeRequest('/api/stats/usage');
            showResult('systemStatsResult', 'ä½¿ç”¨ç»Ÿè®¡', result);
        }

        async function testEfficiencyIndex() {
            const result = await makeRequest('/api/stats/efficiency');
            showResult('systemStatsResult', 'æ•ˆç‡æŒ‡æ•°', result);
        }

        // ç”¨æˆ·ç®¡ç†æµ‹è¯•
        async function testUserList() {
            const result = await makeRequest('/api/user/list?page=1&size=10');
            showResult('userResult', 'ç”¨æˆ·åˆ—è¡¨', result);
        }

        async function testUserStats() {
            const result = await makeRequest('/api/user/stats');
            showResult('userResult', 'ç”¨æˆ·ç»Ÿè®¡', result);
        }

        async function testAddUser() {
            const userData = {
                username: 'test_user_' + Date.now(),
                name: 'æµ‹è¯•ç”¨æˆ·',
                email: 'test@example.com',
                role: 'student',
                password: '123456'
            };
            const result = await makeRequest('/api/user/add', 'POST', userData);
            showResult('userResult', 'æ·»åŠ ç”¨æˆ·', result);
        }

        // èµ„æºç®¡ç†æµ‹è¯•
        async function testResourceList() {
            const result = await makeRequest('/api/stats/resources?page=1&size=10');
            showResult('resourceResult', 'èµ„æºåˆ—è¡¨', result);
        }

        async function testResourceStats() {
            const result = await makeRequest('/api/stats/resources/stats');
            showResult('resourceResult', 'èµ„æºç»Ÿè®¡', result);
        }

        async function testCourseResources() {
            const result = await makeRequest('/api/course-resources/list?page=1&size=10');
            showResult('resourceResult', 'è¯¾ç¨‹èµ„æº', result);
        }

        // æˆç»©åˆ†ææµ‹è¯•
        async function testGradeDistribution() {
            const result = await makeRequest('/api/stats/grade-distribution');
            showResult('gradeResult', 'æˆç»©åˆ†å¸ƒ', result);
        }

        async function testErrorTopics() {
            const result = await makeRequest('/api/stats/error-topics');
            showResult('gradeResult', 'é”™è¯¯çŸ¥è¯†ç‚¹', result);
        }

        async function testLearningTrends() {
            const result = await makeRequest('/api/stats/learning-trends');
            showResult('gradeResult', 'å­¦ä¹ è¶‹åŠ¿', result);
        }

        // ç³»ç»Ÿç›‘æ§æµ‹è¯•
        async function testSystemStatus() {
            const result = await makeRequest('/api/stats/status');
            showResult('monitorResult', 'ç³»ç»ŸçŠ¶æ€', result);
        }

        async function testPerformanceMetrics() {
            const result = await makeRequest('/api/stats/performance');
            showResult('monitorResult', 'æ€§èƒ½æŒ‡æ ‡', result);
        }

        async function testSystemInfo() {
            const result = await makeRequest('/api/stats/info');
            showResult('monitorResult', 'ç³»ç»Ÿä¿¡æ¯', result);
        }

        // ç»¼åˆæµ‹è¯•
        async function testAllAPIs() {
            const overallElement = document.getElementById('overallResult');
            overallElement.style.display = 'block';
            overallElement.innerHTML = '<div class="status loading">TESTING</div> æ­£åœ¨æµ‹è¯•æ‰€æœ‰API...';
            
            const tests = [
                { name: 'ç³»ç»Ÿç»Ÿè®¡', url: '/api/stats/system' },
                { name: 'ç”¨æˆ·åˆ—è¡¨', url: '/api/user/list?page=1&size=5' },
                { name: 'èµ„æºåˆ—è¡¨', url: '/api/stats/resources?page=1&size=5' },
                { name: 'æˆç»©åˆ†å¸ƒ', url: '/api/stats/grade-distribution' },
                { name: 'ç³»ç»ŸçŠ¶æ€', url: '/api/stats/status' },
                { name: 'æ•ˆç‡æŒ‡æ•°', url: '/api/stats/efficiency' },
                { name: 'ä½¿ç”¨ç»Ÿè®¡', url: '/api/stats/usage' },
                { name: 'æ€§èƒ½æŒ‡æ ‡', url: '/api/stats/performance' }
            ];
            
            const results = [];
            
            for (const test of tests) {
                const result = await makeRequest(test.url);
                results.push({
                    name: test.name,
                    success: result.success,
                    status: result.status || 'N/A',
                    hasData: result.success && result.data && Object.keys(result.data).length > 0
                });
            }
            
            let html = '<h3>ğŸ“‹ APIæµ‹è¯•æ€»ç»“</h3>';
            let successCount = 0;
            
            results.forEach(result => {
                const statusClass = result.success ? 'success' : 'error';
                const statusIcon = result.success ? 'âœ…' : 'âŒ';
                const dataIcon = result.hasData ? 'ğŸ“Š' : 'ğŸ“„';
                
                html += `
                    <div style="margin: 8px 0; padding: 8px; border-radius: 4px; background: ${result.success ? '#f0f8f0' : '#fdf0f0'}">
                        ${statusIcon} ${dataIcon} <strong>${result.name}</strong> 
                        <span class="status ${statusClass}">${result.status}</span>
                        ${result.hasData ? '<small>(æœ‰æ•°æ®)</small>' : '<small>(æ— æ•°æ®)</small>'}
                    </div>
                `;
                
                if (result.success) successCount++;
            });
            
            const successRate = ((successCount / results.length) * 100).toFixed(1);
            html += `
                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                    <strong>æµ‹è¯•ç»“æœï¼š</strong> ${successCount}/${results.length} æˆåŠŸ (${successRate}%)
                </div>
            `;
            
            overallElement.innerHTML = html;
            overallElement.className = successCount === results.length ? 'result success' : 'result error';
        }

        // æ¸…ç©ºæ‰€æœ‰ç»“æœ
        function clearAllResults() {
            const results = document.querySelectorAll('.result');
            results.forEach(result => {
                result.style.display = 'none';
                result.innerHTML = '';
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            console.log('ç®¡ç†å‘˜APIæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ç«¯å£8080');
        };
    </script>
</body>
</html> 