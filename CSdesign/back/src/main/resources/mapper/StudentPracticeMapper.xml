<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.experiment.mapper.StudentPracticeMapper">
    
    <resultMap id="StudentPracticeResultMap" type="com.experiment.pojo.StudentPractice">
        <id column="id" property="id"/>
        <result column="student_id" property="studentId"/>
        <result column="practice_id" property="practiceId"/>
        <result column="score" property="score"/>
        <result column="total_score" property="totalScore"/>
        <result column="accuracy" property="accuracy"/>
        <result column="status" property="status"/>
        <result column="start_time" property="startTime"/>
        <result column="complete_time" property="completeTime"/>
        <result column="duration" property="duration"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>
    
    <insert id="insert" parameterType="com.experiment.pojo.StudentPractice" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO student_practice (student_id, practice_id, score, total_score, accuracy, status, start_time, complete_time, duration, create_time, update_time)
        VALUES (#{studentId}, #{practiceId}, #{score}, #{totalScore}, #{accuracy}, #{status}, #{startTime}, #{completeTime}, #{duration}, #{createTime}, #{updateTime})
    </insert>
    
    <select id="selectById" resultMap="StudentPracticeResultMap">
        SELECT * FROM student_practice WHERE id = #{id}
    </select>
    
    <select id="selectByStudentId" resultMap="StudentPracticeResultMap">
        SELECT * FROM student_practice WHERE student_id = #{studentId} ORDER BY create_time DESC
    </select>
    
    <select id="selectByPracticeId" resultMap="StudentPracticeResultMap">
        SELECT * FROM student_practice WHERE practice_id = #{practiceId} ORDER BY create_time DESC
    </select>
    
    <select id="selectByStudentAndPractice" resultMap="StudentPracticeResultMap">
        SELECT * FROM student_practice WHERE student_id = #{studentId} AND practice_id = #{practiceId}
    </select>
    
    <update id="update" parameterType="com.experiment.pojo.StudentPractice">
        UPDATE student_practice 
        SET student_id = #{studentId}, practice_id = #{practiceId}, score = #{score}, total_score = #{totalScore},
            accuracy = #{accuracy}, status = #{status}, start_time = #{startTime}, complete_time = #{completeTime},
            duration = #{duration}, update_time = #{updateTime}
        WHERE id = #{id}
    </update>
    
    <delete id="deleteById">
        DELETE FROM student_practice WHERE id = #{id}
    </delete>
    
    <select id="selectAverageScoreByStudent" resultType="java.lang.Double">
        SELECT AVG(score) FROM student_practice WHERE student_id = #{studentId} AND score IS NOT NULL
    </select>
    
    <select id="selectAverageScoreByPractice" resultType="java.lang.Double">
        SELECT AVG(score) FROM student_practice WHERE practice_id = #{practiceId} AND score IS NOT NULL
    </select>
    
</mapper> 