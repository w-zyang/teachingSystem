<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾å ‚æ€»ç»“éŸ³é¢‘ä¸Šä¼  & Whisper è¯­éŸ³è½¬æ–‡å­—æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #444;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-control:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .btn-info {
            background-color: #17a2b8;
        }
        .btn-info:hover {
            background-color: #138496;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #333;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 500px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.5;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        .loading {
            background-color: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1565c0;
        }
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            cursor: pointer;
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .file-input-wrapper:hover {
            border-color: #4CAF50;
            background: #f0fff0;
        }
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }
        .audio-preview {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .audio-preview audio {
            width: 100%;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ è¯¾å ‚æ€»ç»“éŸ³é¢‘ä¸Šä¼  & Whisper è¯­éŸ³è½¬æ–‡å­—æµ‹è¯•</h1>
        <div style="background-color: #e8f5e9; border-left: 4px solid #4CAF50; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
            <strong>âœ¨ æ–°åŠŸèƒ½ï¼š</strong>ç°åœ¨æ”¯æŒä½¿ç”¨æœ¬åœ° Whisper æ¨¡å‹è¿›è¡Œè¯­éŸ³è½¬æ–‡å­—ï¼<br>
            <strong>æ¨èæµç¨‹ï¼š</strong>ä½¿ç”¨"ä¸€é”®æµ‹è¯•ï¼šä¸Šä¼  + Whisper è½¬æ–‡å­—"åŠŸèƒ½ï¼Œè‡ªåŠ¨å®Œæˆå®Œæ•´æµç¨‹ã€‚
        </div>
        
        <!-- æ—¥å¿—æç¤º -->
        <div style="background-color: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
            <strong>ğŸ“‹ è¯¦ç»†æ—¥å¿—æç¤ºï¼š</strong>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #555;">
                æ‰€æœ‰è¯¦ç»†çš„è¯·æ±‚å’Œé”™è¯¯æ—¥å¿—éƒ½ä¼šè¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°ï¼ˆæŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ Console æ ‡ç­¾é¡µï¼‰ã€‚<br>
                é”™è¯¯ä¿¡æ¯åŒ…æ‹¬ï¼šè¯·æ±‚URLã€çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”ä½“ã€é”™è¯¯å †æ ˆç­‰å®Œæ•´ä¿¡æ¯ã€‚
            </p>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-label">æ€»è¯·æ±‚æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successCount">0</div>
                <div class="stat-label">æˆåŠŸæ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="errorCount">0</div>
                <div class="stat-label">å¤±è´¥æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgResponseTime">0ms</div>
                <div class="stat-label">å¹³å‡å“åº”æ—¶é—´</div>
            </div>
        </div>

        <!-- 1. ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ -->
        <div class="test-section">
            <div class="test-title">1. ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶</div>
            <div class="form-group">
                <label>è¯¾ç¨‹ID:</label>
                <input type="number" id="uploadCourseId" class="form-control" value="21" placeholder="è¾“å…¥è¯¾ç¨‹ID">
            </div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID (å¯é€‰):</label>
                <input type="number" id="uploadSummaryId" class="form-control" value="" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“IDï¼Œç•™ç©ºåˆ™ä»…ä¸Šä¼ æ–‡ä»¶">
            </div>
            <div class="form-group">
                <label>éŸ³é¢‘æ—¶é•¿ (ç§’ï¼Œå¯é€‰):</label>
                <input type="number" id="uploadAudioDuration" class="form-control" value="" placeholder="è¾“å…¥éŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨æ£€æµ‹">
            </div>
            <div class="form-group">
                <label>é€‰æ‹©éŸ³é¢‘æ–‡ä»¶:</label>
                <div class="file-input-wrapper" onclick="document.getElementById('audioFile').click()">
                    <input type="file" id="audioFile" accept=".mp3,.wav,.m4a,.webm,.ogg" onchange="handleFileSelect()">
                    <div id="fileDisplayName">ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)</div>
                </div>
                <div id="fileInfo" class="file-info" style="display: none;"></div>
                <div id="audioPreview" class="audio-preview" style="display: none;"></div>
            </div>
            <button onclick="uploadAudioFile()" id="uploadBtn">ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶</button>
            <div id="uploadResult" class="result"></div>
        </div>

        <!-- 2. åˆ›å»ºè¯¾å ‚æ€»ç»“ -->
        <div class="test-section">
            <div class="test-title">2. åˆ›å»ºè¯¾å ‚æ€»ç»“</div>
            <div class="form-group">
                <label>è¯¾ç¨‹ID:</label>
                <input type="number" id="createCourseId" class="form-control" value="21" placeholder="è¾“å…¥è¯¾ç¨‹ID">
            </div>
            <div class="form-group">
                <label>æ•™å¸ˆID:</label>
                <input type="number" id="createTeacherId" class="form-control" value="2" placeholder="è¾“å…¥æ•™å¸ˆID">
            </div>
            <div class="form-group">
                <label>è¯¾å ‚æ ‡é¢˜:</label>
                <input type="text" id="createTitle" class="form-control" value="æµ‹è¯•è¯¾å ‚" placeholder="è¾“å…¥è¯¾å ‚æ ‡é¢˜">
            </div>
            <div class="form-group">
                <label>è¯¾å ‚æè¿°:</label>
                <textarea id="createDescription" class="form-control" placeholder="è¾“å…¥è¯¾å ‚æè¿°">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯¾å ‚æ€»ç»“</textarea>
            </div>
            <div class="form-group">
                <label>å…³é”®è¯:</label>
                <input type="text" id="createKeywords" class="form-control" value="æµ‹è¯•,è¯¾å ‚" placeholder="ç”¨é€—å·åˆ†éš”å…³é”®è¯">
            </div>
            <button onclick="createClassSummary()">åˆ›å»ºè¯¾å ‚æ€»ç»“</button>
            <div id="createResult" class="result"></div>
        </div>

        <!-- 3. Whisper è¯­éŸ³è½¬æ–‡å­—ï¼ˆæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼‰âœ¨ -->
        <div class="test-section" style="border: 2px solid #4CAF50; background-color: #f0fff0;">
            <div class="test-title">3. Whisper è¯­éŸ³è½¬æ–‡å­—ï¼ˆæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼‰âœ¨ æ¨è</div>
            <div style="background-color: #e8f5e9; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 13px; color: #555;">
                <strong>ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. å…ˆä½¿ç”¨"ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶"åŠŸèƒ½ä¸Šä¼ éŸ³é¢‘ï¼Œè·å–æœ¬åœ°æ–‡ä»¶è·¯å¾„<br>
                2. æ–‡ä»¶è·¯å¾„ä¼šè‡ªåŠ¨å¡«å……åˆ°ä¸‹æ–¹è¾“å…¥æ¡†<br>
                3. ç‚¹å‡»"å¼€å§‹ Whisper è¯­éŸ³è½¬æ–‡å­—"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè°ƒç”¨æœ¬åœ° Whisper æ¨¡å‹è¿›è¡Œè¯†åˆ«<br>
                4. å¤„ç†æ—¶é—´å–å†³äºéŸ³é¢‘é•¿åº¦å’Œæ¨¡å‹å¤§å°ï¼ˆmedium æ¨¡å‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
            </div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="transcriptSummaryId" class="form-control" value="1" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“IDï¼ˆå¿…å¡«ï¼‰">
            </div>
            <div class="form-group">
                <label>éŸ³é¢‘æ–‡ä»¶æœ¬åœ°è·¯å¾„:</label>
                <input type="text" id="transcriptAudioPath" class="form-control" value="" placeholder="è¾“å…¥éŸ³é¢‘æ–‡ä»¶æœ¬åœ°è·¯å¾„ï¼ˆå¦‚ï¼šD:\my_git\CSdesign\back\uploads\audio\course21\xxx.wavï¼‰">
                <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                    æç¤ºï¼šä¸Šä¼ æ–‡ä»¶åä¼šè‡ªåŠ¨å¡«å……æ­¤è·¯å¾„
                </small>
            </div>
            <button class="btn-info" onclick="processAudioToText()" id="whisperProcessBtn" style="background-color: #4CAF50;">
                ğŸ¤ å¼€å§‹ Whisper è¯­éŸ³è½¬æ–‡å­—
            </button>
            <div id="transcriptResult" class="result"></div>
        </div>

        <!-- 3.5. ä¸€é”®æµ‹è¯•ï¼šä¸Šä¼  + Whisper è½¬æ–‡å­—ï¼ˆå®Œæ•´æµç¨‹ï¼‰ -->
        <div class="test-section" style="border: 2px solid #2196F3; background-color: #e3f2fd;">
            <div class="test-title">3.5. ä¸€é”®æµ‹è¯•ï¼šä¸Šä¼  + Whisper è½¬æ–‡å­—ï¼ˆå®Œæ•´æµç¨‹ï¼‰ğŸš€</div>
            <div style="background-color: #bbdefb; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 13px; color: #555;">
                <strong>ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                æ­¤åŠŸèƒ½ä¼šè‡ªåŠ¨å®Œæˆï¼šä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ â†’ è·å–æ–‡ä»¶è·¯å¾„ â†’ è°ƒç”¨ Whisper è½¬æ–‡å­—<br>
                é€‚åˆå¿«é€Ÿæµ‹è¯•å®Œæ•´æµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶è·¯å¾„
            </div>
            <div class="form-group">
                <label>è¯¾ç¨‹ID:</label>
                <input type="number" id="quickTestCourseId" class="form-control" value="21" placeholder="è¾“å…¥è¯¾ç¨‹ID">
            </div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="quickTestSummaryId" class="form-control" value="" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“IDï¼ˆå¿…å¡«ï¼‰">
            </div>
            <div class="form-group">
                <label>é€‰æ‹©éŸ³é¢‘æ–‡ä»¶:</label>
                <div class="file-input-wrapper" onclick="document.getElementById('quickTestAudioFile').click()">
                    <input type="file" id="quickTestAudioFile" accept=".mp3,.wav,.m4a,.webm,.ogg" onchange="handleQuickTestFileSelect()">
                    <div id="quickTestFileDisplayName">ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)</div>
                </div>
                <div id="quickTestFileInfo" class="file-info" style="display: none;"></div>
            </div>
            <button class="btn-warning" onclick="quickTestUploadAndTranscribe()" id="quickTestBtn" style="background-color: #2196F3; color: white;">
                ğŸš€ ä¸Šä¼ å¹¶è½¬æ–‡å­—ï¼ˆä¸€é”®æµ‹è¯•ï¼‰
            </button>
            <div id="quickTestResult" class="result"></div>
        </div>

        <!-- 3.6. ç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™ç”¨äºå…¼å®¹ï¼‰ -->
        <div class="test-section" style="opacity: 0.6;">
            <div class="test-title">3.6. ç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼ˆå·²åºŸå¼ƒï¼‰âš ï¸</div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="baiduSummaryId" class="form-control" value="" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“IDï¼ˆå¿…å¡«ï¼‰">
            </div>
            <div class="form-group">
                <label>è¯¾ç¨‹ID:</label>
                <input type="number" id="baiduCourseId" class="form-control" value="21" placeholder="è¾“å…¥è¯¾ç¨‹IDï¼ˆç”¨äºä¸Šä¼ åˆ°OSSï¼‰">
            </div>
            <div class="form-group">
                <label>é€‰æ‹©éŸ³é¢‘æ–‡ä»¶:</label>
                <div class="file-input-wrapper" onclick="document.getElementById('baiduAudioFile').click()">
                    <input type="file" id="baiduAudioFile" accept=".mp3,.wav,.m4a,.webm,.ogg" onchange="handleBaiduFileSelect()">
                    <div id="baiduFileDisplayName">ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)</div>
                </div>
                <div id="baiduFileInfo" class="file-info" style="display: none;"></div>
                <div id="baiduAudioPreview" class="audio-preview" style="display: none;"></div>
            </div>
            <button class="btn-warning" onclick="processBaiduSpeechToText()" id="baiduProcessBtn">ä¸Šä¼ å¹¶è½¬æ–‡å­—ï¼ˆç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼‰</button>
            <div id="baiduResult" class="result"></div>
        </div>

        <!-- 3.7. ä½¿ç”¨å·²æœ‰OSS URLè¿›è¡Œè¯­éŸ³è½¬æ–‡å­—ï¼ˆå·²åºŸå¼ƒï¼‰ -->
        <div class="test-section" style="opacity: 0.6;">
            <div class="test-title">3.7. ä½¿ç”¨å·²æœ‰OSS URLè¿›è¡Œè¯­éŸ³è½¬æ–‡å­—ï¼ˆå·²åºŸå¼ƒï¼‰âš ï¸</div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="urlSummaryId" class="form-control" value="" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“ID">
            </div>
            <div class="form-group">
                <label>OSSéŸ³é¢‘URL:</label>
                <input type="text" id="audioUrl" class="form-control" value="" placeholder="è¾“å…¥OSSéŸ³é¢‘æ–‡ä»¶URLï¼ˆå¦‚ï¼šhttps://oss-xxx.aliyuncs.com/audio/xxx.mp3ï¼‰">
            </div>
            <button class="btn-info" onclick="processAudioFromUrl()" id="urlProcessBtn">ä½¿ç”¨URLè½¬æ–‡å­—</button>
            <div id="urlResult" class="result"></div>
        </div>

        <!-- 4. AIç”Ÿæˆé‡ç‚¹æ•´ç† -->
        <div class="test-section">
            <div class="test-title">4. AIç”Ÿæˆé‡ç‚¹æ•´ç†</div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="aiSummaryId" class="form-control" value="1" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“ID">
            </div>
            <div class="form-group">
                <label>è½¬å½•æ–‡æœ¬:</label>
                <textarea id="aiTranscriptText" class="form-control" placeholder="è¾“å…¥è½¬å½•çš„æ–‡æœ¬å†…å®¹">ä»Šå¤©æˆ‘ä»¬å­¦ä¹ Linuxç³»ç»Ÿç®¡ç†çš„é«˜çº§æŠ€å·§ã€‚é¦–å…ˆè®²è§£ç”¨æˆ·æƒé™ç®¡ç†ï¼ŒåŒ…æ‹¬sudoé…ç½®ã€ç»„æƒé™è®¾ç½®ç­‰ã€‚</textarea>
            </div>
            <div class="form-group">
                <label>è¯¾ä»¶å†…å®¹ (å¯é€‰):</label>
                <textarea id="aiCoursewareContent" class="form-control" placeholder="è¾“å…¥è¯¾ä»¶å†…å®¹">Linuxç³»ç»Ÿç®¡ç†è¿›é˜¶æ•™ç¨‹å¤§çº²ï¼š\n1. ç”¨æˆ·æƒé™ç®¡ç†\n2. ç³»ç»Ÿç›‘æ§å·¥å…·\n3. æ—¥å¿—åˆ†ææŠ€å·§</textarea>
            </div>
            <button class="btn-warning" onclick="generateAISummary()">ç”ŸæˆAIé‡ç‚¹æ•´ç†</button>
            <div id="aiResult" class="result"></div>
        </div>

        <!-- 5. è·å–æ•™å¸ˆè¯¾å ‚æ€»ç»“åˆ—è¡¨ -->
        <div class="test-section">
            <div class="test-title">5. è·å–æ•™å¸ˆè¯¾å ‚æ€»ç»“åˆ—è¡¨</div>
            <div class="form-group">
                <label>æ•™å¸ˆID:</label>
                <input type="number" id="listTeacherId" class="form-control" value="2" placeholder="è¾“å…¥æ•™å¸ˆID">
            </div>
            <button class="btn-info" onclick="getTeacherSummaries()">è·å–åˆ—è¡¨</button>
            <div id="listResult" class="result"></div>
        </div>

        <!-- 6. æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ä¿¡æ¯ -->
        <div class="test-section">
            <div class="test-title">6. æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ä¿¡æ¯</div>
            <div class="form-group">
                <label>è¯¾å ‚æ€»ç»“ID:</label>
                <input type="number" id="testSummaryId" class="form-control" value="1" placeholder="è¾“å…¥è¯¾å ‚æ€»ç»“ID">
            </div>
            <button class="btn-info" onclick="testAudioFile()">æµ‹è¯•éŸ³é¢‘æ–‡ä»¶</button>
            <div id="testResult" class="result"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8080/api/class-summary';
        
        // ç»Ÿè®¡æ•°æ®
        let stats = {
            totalRequests: 0,
            successCount: 0,
            errorCount: 0,
            responseTimes: []
        };

        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            document.getElementById('totalRequests').textContent = stats.totalRequests;
            document.getElementById('successCount').textContent = stats.successCount;
            document.getElementById('errorCount').textContent = stats.errorCount;
            
            const avgTime = stats.responseTimes.length > 0 
                ? Math.round(stats.responseTimes.reduce((a, b) => a + b, 0) / stats.responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
        }

        // è¯¦ç»†é”™è¯¯æ—¥å¿—å‡½æ•°
        function logError(context, error, additionalInfo = {}) {
            const timestamp = new Date().toISOString();
            const errorDetails = {
                timestamp: timestamp,
                context: context,
                error: {
                    name: error?.name || 'Unknown',
                    message: error?.message || String(error),
                    stack: error?.stack || 'No stack trace available'
                },
                ...additionalInfo
            };
            
            // è¾“å‡ºåˆ°æ§åˆ¶å°
            console.error('========== è¯¦ç»†é”™è¯¯æ—¥å¿— ==========');
            console.error('æ—¶é—´:', timestamp);
            console.error('ä¸Šä¸‹æ–‡:', context);
            console.error('é”™è¯¯åç§°:', errorDetails.error.name);
            console.error('é”™è¯¯æ¶ˆæ¯:', errorDetails.error.message);
            console.error('é”™è¯¯å †æ ˆ:', errorDetails.error.stack);
            if (Object.keys(additionalInfo).length > 0) {
                console.error('é™„åŠ ä¿¡æ¯:', additionalInfo);
            }
            console.error('å®Œæ•´é”™è¯¯å¯¹è±¡:', errorDetails);
            console.error('================================');
            
            return errorDetails;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data, isError = false, isLoading = false) {
            const resultDiv = document.getElementById(elementId);
            if (isLoading) {
                resultDiv.className = 'result loading';
                resultDiv.textContent = 'è¯·æ±‚ä¸­...';
            } else if (isError) {
                resultDiv.className = 'result error';
                // å¦‚æœæ˜¯é”™è¯¯å¯¹è±¡ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                if (data && typeof data === 'object' && data.errorDetails) {
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
                }
            } else {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(data, null, 2);
            }
        }

        // é€šç”¨APIè¯·æ±‚å‡½æ•°
        async function makeRequest(url, options = {}) {
            const startTime = Date.now();
            stats.totalRequests++;
            updateStats();

            try {
                console.log('========== å‘èµ·APIè¯·æ±‚ ==========');
                console.log('URL:', url);
                console.log('æ–¹æ³•:', options.method || 'GET');
                console.log('è¯·æ±‚å¤´:', options.headers || {});
                if (options.body) {
                    console.log('è¯·æ±‚ä½“ç±»å‹:', typeof options.body);
                    if (options.body instanceof FormData) {
                        console.log('è¯·æ±‚ä½“: FormData');
                        for (let pair of options.body.entries()) {
                            console.log(`  ${pair[0]}:`, pair[1] instanceof File ? 
                                `[File: ${pair[1].name}, ${(pair[1].size / 1024 / 1024).toFixed(2)} MB]` : 
                                pair[1]);
                        }
                    } else {
                        console.log('è¯·æ±‚ä½“:', options.body);
                    }
                }
                console.log('================================');

                // åˆ›å»ºAbortControllerç”¨äºè¶…æ—¶æ§åˆ¶
                const controller = new AbortController();
                // Whisper å¤„ç†å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯ medium æ¨¡å‹ï¼Œè®¾ç½®ä¸º 10 åˆ†é’Ÿ
                const timeoutId = setTimeout(() => controller.abort(), 600000); // 600ç§’è¶…æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰

                try {
                    const response = await fetch(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        signal: controller.signal, // æ·»åŠ è¶…æ—¶æ§åˆ¶
                        ...options
                    });
                    clearTimeout(timeoutId); // è¯·æ±‚æˆåŠŸï¼Œæ¸…é™¤è¶…æ—¶

                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    stats.responseTimes.push(responseTime);

                    console.log('========== æ”¶åˆ°å“åº” ==========');
                    console.log('çŠ¶æ€ç :', response.status, response.statusText);
                    console.log('å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                    console.log('å“åº”æ—¶é—´:', responseTime + 'ms');
                    console.log('================================');

                    let data;
                    try {
                        const text = await response.text();
                        console.log('å“åº”ä½“åŸå§‹å†…å®¹:', text.substring(0, 500) + (text.length > 500 ? '...' : ''));
                        data = JSON.parse(text);
                    } catch (parseError) {
                        console.error('è§£æå“åº”JSONå¤±è´¥:', parseError);
                        const text = await response.text();
                        data = { 
                            _parseError: true,
                            _rawResponse: text.substring(0, 1000),
                            error: 'å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼'
                        };
                    }
                    
                    if (response.ok) {
                        stats.successCount++;
                        console.log('è¯·æ±‚æˆåŠŸ');
                    } else {
                        stats.errorCount++;
                        console.error('è¯·æ±‚å¤±è´¥ - çŠ¶æ€ç :', response.status);
                        console.error('é”™è¯¯å“åº”:', data);
                        
                        // è®°å½•è¯¦ç»†é”™è¯¯
                        logError('APIè¯·æ±‚å¤±è´¥', new Error(`HTTP ${response.status}: ${response.statusText}`), {
                            url: url,
                            status: response.status,
                            statusText: response.statusText,
                            responseHeaders: Object.fromEntries(response.headers.entries()),
                            responseBody: data,
                            responseTime: responseTime
                        });
                    }
                    updateStats();
                    
                    return { success: response.ok, data, responseTime, status: response.status };
                } catch (fetchError) {
                    clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶
                    if (fetchError.name === 'AbortError') {
                        // è¶…æ—¶é”™è¯¯
                        const endTime = Date.now();
                        const responseTime = endTime - startTime;
                        stats.responseTimes.push(responseTime);
                        stats.errorCount++;
                        updateStats();
                        
                        const timeoutError = new Error('è¯·æ±‚è¶…æ—¶ï¼ˆè¶…è¿‡120ç§’ï¼‰');
                        const errorDetails = logError('APIè¯·æ±‚è¶…æ—¶', timeoutError, {
                            url: url,
                            method: options.method || 'GET',
                            responseTime: responseTime,
                            errorType: 'TimeoutError',
                            timeout: 120000
                        });
                        
                        return { 
                            success: false, 
                            error: 'è¯·æ±‚è¶…æ—¶ï¼ŒAIç”Ÿæˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·ç¨åé‡è¯•', 
                            responseTime,
                            errorDetails: errorDetails
                        };
                    }
                    // å…¶ä»–é”™è¯¯ï¼Œç»§ç»­æŠ›å‡º
                    throw fetchError;
                }
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);
                stats.errorCount++;
                updateStats();
                
                // è®°å½•è¯¦ç»†é”™è¯¯
                const errorDetails = logError('APIè¯·æ±‚å¼‚å¸¸', error, {
                    url: url,
                    method: options.method || 'GET',
                    responseTime: responseTime,
                    errorType: error.constructor.name
                });
                
                return { 
                    success: false, 
                    error: error.message, 
                    responseTime,
                    errorDetails: errorDetails
                };
            }
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect() {
            const fileInput = document.getElementById('audioFile');
            const fileInfoDiv = document.getElementById('fileInfo');
            const audioPreviewDiv = document.getElementById('audioPreview');
            const displayNameDiv = document.getElementById('fileDisplayName');
            
            if (fileInput.files[0]) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                displayNameDiv.textContent = `âœ… å·²é€‰æ‹©: ${file.name} (${fileSize} MB)`;
                
                fileInfoDiv.style.display = 'block';
                fileInfoDiv.innerHTML = `
                    <strong>æ–‡ä»¶ä¿¡æ¯:</strong><br>
                    æ–‡ä»¶å: ${file.name}<br>
                    æ–‡ä»¶å¤§å°: ${fileSize} MB<br>
                    æ–‡ä»¶ç±»å‹: ${file.type || 'æœªçŸ¥'}<br>
                    æœ€åä¿®æ”¹: ${new Date(file.lastModified).toLocaleString()}
                `;
                
                // å¦‚æœæ˜¯éŸ³é¢‘æ–‡ä»¶ï¼Œæ˜¾ç¤ºé¢„è§ˆ
                if (file.type.startsWith('audio/')) {
                    const audioUrl = URL.createObjectURL(file);
                    audioPreviewDiv.style.display = 'block';
                    audioPreviewDiv.innerHTML = `
                        <strong>éŸ³é¢‘é¢„è§ˆ:</strong><br>
                        <audio controls src="${audioUrl}"></audio>
                    `;
                } else {
                    audioPreviewDiv.style.display = 'none';
                }
            } else {
                displayNameDiv.textContent = 'ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)';
                fileInfoDiv.style.display = 'none';
                audioPreviewDiv.style.display = 'none';
            }
        }

        // è·å–éŸ³é¢‘æ—¶é•¿
        function getAudioDuration(file) {
            return new Promise((resolve) => {
                const audio = new Audio();
                audio.addEventListener('loadedmetadata', () => {
                    resolve(Math.floor(audio.duration));
                }, { once: true });
                audio.addEventListener('error', () => {
                    console.warn('æ— æ³•è·å–éŸ³é¢‘æ—¶é•¿');
                    resolve(0);
                }, { once: true });
                audio.src = URL.createObjectURL(file);
            });
        }

        // 1. ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
        async function uploadAudioFile() {
            const fileInput = document.getElementById('audioFile');
            const courseId = document.getElementById('uploadCourseId').value;
            const summaryId = document.getElementById('uploadSummaryId').value;
            const audioDuration = document.getElementById('uploadAudioDuration').value;
            
            if (!fileInput.files[0]) {
                showResult('uploadResult', 'è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶', true);
                return;
            }

            const file = fileInput.files[0];
            const resultDiv = document.getElementById('uploadResult');
            const uploadBtn = document.getElementById('uploadBtn');
            
            showResult('uploadResult', null, false, true);
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'ä¸Šä¼ ä¸­...';

            try {
                // è·å–éŸ³é¢‘æ—¶é•¿
                let duration = audioDuration ? parseInt(audioDuration) : 0;
                if (!duration) {
                    duration = await getAudioDuration(file);
                }

                const formData = new FormData();
                formData.append('audioFile', file);
                formData.append('courseId', courseId);
                if (summaryId) {
                    formData.append('summaryId', summaryId);
                }
                if (duration) {
                    formData.append('audioDuration', duration);
                }

                // æ˜¾ç¤ºFormDataä¿¡æ¯
                console.log('FormDataå†…å®¹:', {
                    hasAudioFile: formData.has('audioFile'),
                    courseId: formData.get('courseId'),
                    summaryId: formData.get('summaryId'),
                    audioDuration: formData.get('audioDuration'),
                    fileSize: file.size,
                    fileName: file.name,
                    fileType: file.type
                });

                const startTime = Date.now();
                stats.totalRequests++;
                updateStats();

                console.log('========== ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ ==========');
                console.log('æ–‡ä»¶ä¿¡æ¯:', {
                    name: file.name,
                    size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                    type: file.type,
                    lastModified: new Date(file.lastModified).toISOString()
                });
                console.log('è¯·æ±‚å‚æ•°:', {
                    courseId: courseId,
                    summaryId: summaryId || '(æœªæä¾›)',
                    audioDuration: duration || '(è‡ªåŠ¨æ£€æµ‹)'
                });
                console.log('è¯·æ±‚URL:', `${BASE_URL}/upload-audio`);
                console.log('================================');

                const response = await fetch(`${BASE_URL}/upload-audio`, {
                    method: 'POST',
                    body: formData
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                console.log('========== ä¸Šä¼ å“åº” ==========');
                console.log('çŠ¶æ€ç :', response.status, response.statusText);
                console.log('å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                console.log('å“åº”æ—¶é—´:', responseTime + 'ms');
                console.log('================================');

                let data;
                try {
                    const text = await response.text();
                    console.log('å“åº”ä½“åŸå§‹å†…å®¹:', text.substring(0, 500) + (text.length > 500 ? '...' : ''));
                    data = JSON.parse(text);
                } catch (parseError) {
                    console.error('è§£æå“åº”JSONå¤±è´¥:', parseError);
                    const text = await response.text();
                    data = { 
                        _parseError: true,
                        _rawResponse: text.substring(0, 1000),
                        error: 'å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼'
                    };
                }
                
                if (response.ok) {
                    stats.successCount++;
                    console.log('ä¸Šä¼ æˆåŠŸ');
                    showResult('uploadResult', {
                        success: true,
                        message: 'ä¸Šä¼ æˆåŠŸ',
                        data: data,
                        responseTime: responseTime + 'ms',
                        filePath: data.data
                    });
                    
                    // å¦‚æœè¿”å›äº†æ–‡ä»¶è·¯å¾„ï¼Œæ›´æ–°è½¬å½•è·¯å¾„è¾“å…¥æ¡†
                    if (data.data) {
                        document.getElementById('transcriptAudioPath').value = data.data;
                        console.log('âœ… æ–‡ä»¶è·¯å¾„å·²è‡ªåŠ¨å¡«å……åˆ° Whisper è¯­éŸ³è½¬æ–‡å­—è¾“å…¥æ¡†');
                    }
                    
                    // å¦‚æœæä¾›äº† summaryIdï¼Œä¹Ÿæ›´æ–°æ€»ç»“IDè¾“å…¥æ¡†
                    if (summaryId) {
                        document.getElementById('transcriptSummaryId').value = summaryId;
                    }
                } else {
                    stats.errorCount++;
                    const errorDetails = logError('ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¤±è´¥', new Error(`HTTP ${response.status}: ${response.statusText}`), {
                        url: `${BASE_URL}/upload-audio`,
                        method: 'POST',
                        status: response.status,
                        statusText: response.statusText,
                        responseHeaders: Object.fromEntries(response.headers.entries()),
                        responseBody: data,
                        responseTime: responseTime,
                        fileInfo: {
                            name: file.name,
                            size: file.size,
                            type: file.type
                        },
                        requestParams: {
                            courseId: courseId,
                            summaryId: summaryId,
                            audioDuration: duration
                        }
                    });
                    
                    showResult('uploadResult', {
                        success: false,
                        error: data.msg || 'ä¸Šä¼ å¤±è´¥',
                        data: data,
                        responseTime: responseTime + 'ms',
                        status: response.status,
                        statusText: response.statusText,
                        errorDetails: errorDetails
                    }, true);
                }
                updateStats();
            } catch (error) {
                stats.errorCount++;
                updateStats();
                
                const errorDetails = logError('ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¼‚å¸¸', error, {
                    url: `${BASE_URL}/upload-audio`,
                    method: 'POST',
                    fileInfo: {
                        name: file.name,
                        size: file.size,
                        type: file.type
                    },
                    requestParams: {
                        courseId: courseId,
                        summaryId: summaryId,
                        audioDuration: audioDuration
                    },
                    errorType: error.constructor.name
                });
                
                showResult('uploadResult', {
                    success: false,
                    error: error.message,
                    errorDetails: errorDetails
                }, true);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶';
            }
        }

        // 2. åˆ›å»ºè¯¾å ‚æ€»ç»“
        async function createClassSummary() {
            const data = {
                courseId: parseInt(document.getElementById('createCourseId').value),
                teacherId: parseInt(document.getElementById('createTeacherId').value),
                title: document.getElementById('createTitle').value,
                description: document.getElementById('createDescription').value,
                keywords: document.getElementById('createKeywords').value
            };

            console.log('========== åˆ›å»ºè¯¾å ‚æ€»ç»“ ==========');
            console.log('è¯·æ±‚å‚æ•°:', data);
            console.log('================================');

            showResult('createResult', null, false, true);
            const result = await makeRequest(BASE_URL + '/create', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result.success) {
                showResult('createResult', result.data);
                // å¦‚æœåˆ›å»ºæˆåŠŸï¼Œæ›´æ–°æ€»ç»“IDè¾“å…¥æ¡†
                if (result.data.data && result.data.data.id) {
                    document.getElementById('uploadSummaryId').value = result.data.data.id;
                    document.getElementById('transcriptSummaryId').value = result.data.data.id;
                    document.getElementById('baiduSummaryId').value = result.data.data.id;
                    document.getElementById('urlSummaryId').value = result.data.data.id;
                    document.getElementById('aiSummaryId').value = result.data.data.id;
                    document.getElementById('testSummaryId').value = result.data.data.id;
                }
            } else {
                const errorDetails = result.errorDetails || {
                    error: result.error,
                    status: result.status
                };
                showResult('createResult', {
                    success: false,
                    error: result.error || 'åˆ›å»ºå¤±è´¥',
                    data: result.data,
                    errorDetails: errorDetails
                }, true);
            }
        }

        // å¤„ç†ä¸€é”®æµ‹è¯•æ–‡ä»¶é€‰æ‹©
        function handleQuickTestFileSelect() {
            const fileInput = document.getElementById('quickTestAudioFile');
            const fileInfoDiv = document.getElementById('quickTestFileInfo');
            const displayNameDiv = document.getElementById('quickTestFileDisplayName');
            
            if (fileInput.files[0]) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                displayNameDiv.textContent = `âœ… å·²é€‰æ‹©: ${file.name} (${fileSize} MB)`;
                
                fileInfoDiv.style.display = 'block';
                fileInfoDiv.innerHTML = `
                    <strong>æ–‡ä»¶ä¿¡æ¯:</strong><br>
                    æ–‡ä»¶å: ${file.name}<br>
                    æ–‡ä»¶å¤§å°: ${fileSize} MB<br>
                    æ–‡ä»¶ç±»å‹: ${file.type || 'æœªçŸ¥'}<br>
                    æœ€åä¿®æ”¹: ${new Date(file.lastModified).toLocaleString()}
                `;
            } else {
                displayNameDiv.textContent = 'ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)';
                fileInfoDiv.style.display = 'none';
            }
        }

        // ä¸€é”®æµ‹è¯•ï¼šä¸Šä¼  + Whisper è½¬æ–‡å­—
        async function quickTestUploadAndTranscribe() {
            const fileInput = document.getElementById('quickTestAudioFile');
            const courseId = document.getElementById('quickTestCourseId').value;
            const summaryId = document.getElementById('quickTestSummaryId').value;
            const resultDiv = document.getElementById('quickTestResult');
            const quickTestBtn = document.getElementById('quickTestBtn');
            
            if (!fileInput.files[0]) {
                showResult('quickTestResult', 'è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶', true);
                return;
            }

            if (!summaryId) {
                showResult('quickTestResult', 'è¯·è¾“å…¥è¯¾å ‚æ€»ç»“ID', true);
                return;
            }

            if (!courseId) {
                showResult('quickTestResult', 'è¯·è¾“å…¥è¯¾ç¨‹ID', true);
                return;
            }

            const file = fileInput.files[0];
            
            showResult('quickTestResult', null, false, true);
            quickTestBtn.disabled = true;
            quickTestBtn.textContent = 'â³ å¤„ç†ä¸­ï¼ˆä¸Šä¼  + Whisper è½¬æ–‡å­—ï¼‰...';

            try {
                // ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
                console.log('========== æ­¥éª¤1: ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ ==========');
                const formData = new FormData();
                formData.append('audioFile', file);
                formData.append('courseId', courseId);
                formData.append('summaryId', summaryId);

                const uploadStartTime = Date.now();
                stats.totalRequests++;
                updateStats();

                const uploadResponse = await fetch(`${BASE_URL}/upload-audio`, {
                    method: 'POST',
                    body: formData
                });

                const uploadEndTime = Date.now();
                const uploadResponseTime = uploadEndTime - uploadStartTime;
                stats.responseTimes.push(uploadResponseTime);

                let uploadData;
                try {
                    const text = await uploadResponse.text();
                    uploadData = JSON.parse(text);
                } catch (parseError) {
                    throw new Error('è§£æä¸Šä¼ å“åº”å¤±è´¥: ' + parseError.message);
                }

                if (!uploadResponse.ok) {
                    throw new Error('ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¤±è´¥: ' + (uploadData.msg || uploadResponse.statusText));
                }

                const audioFilePath = uploadData.data;
                console.log('========== ä¸Šä¼ æˆåŠŸ ==========');
                console.log('æ–‡ä»¶è·¯å¾„:', audioFilePath);
                console.log('ä¸Šä¼ è€—æ—¶:', uploadResponseTime + 'ms');

                // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨æ–‡ä»¶è·¯å¾„è¿›è¡Œ Whisper è¯­éŸ³è½¬æ–‡å­—
                console.log('========== æ­¥éª¤2: Whisper è¯­éŸ³è½¬æ–‡å­— ==========');
                console.log('æ–‡ä»¶è·¯å¾„:', audioFilePath);
                console.log('æ€»ç»“ID:', summaryId);

                const sttStartTime = Date.now();
                stats.totalRequests++;
                updateStats();

                const sttResult = await makeRequest(BASE_URL + '/process-audio', {
                    method: 'POST',
                    body: JSON.stringify({
                        summaryId: parseInt(summaryId),
                        audioFilePath: audioFilePath
                    })
                });

                const sttEndTime = Date.now();
                const totalTime = sttEndTime - uploadStartTime;

                if (sttResult.success) {
                    stats.successCount++;
                    console.log('========== å®Œæ•´æµç¨‹æˆåŠŸ ==========');
                    console.log('æ€»è€—æ—¶:', totalTime + 'ms');
                    
                    const transcriptText = sttResult.data?.data || '';
                    showResult('quickTestResult', {
                        success: true,
                        message: 'å®Œæ•´æµç¨‹æˆåŠŸï¼ˆä¸Šä¼  + Whisper è½¬æ–‡å­—ï¼‰',
                        uploadTime: uploadResponseTime + 'ms',
                        sttTime: (sttEndTime - sttStartTime) + 'ms',
                        totalTime: totalTime + 'ms',
                        audioFilePath: audioFilePath,
                        transcriptText: transcriptText,
                        transcriptLength: transcriptText.length,
                        fullResponse: sttResult.data
                    });
                    
                    // æ›´æ–°ç›¸å…³è¾“å…¥æ¡†
                    document.getElementById('transcriptAudioPath').value = audioFilePath;
                    document.getElementById('transcriptSummaryId').value = summaryId;
                    if (transcriptText) {
                        document.getElementById('aiTranscriptText').value = transcriptText;
                    }
                } else {
                    stats.errorCount++;
                    showResult('quickTestResult', {
                        success: false,
                        error: 'Whisper è¯­éŸ³è½¬æ–‡å­—å¤±è´¥',
                        uploadSuccess: true,
                        audioFilePath: audioFilePath,
                        uploadTime: uploadResponseTime + 'ms',
                        sttError: sttResult.error || 'æœªçŸ¥é”™è¯¯',
                        sttResponse: sttResult.data,
                        errorDetails: sttResult.errorDetails
                    }, true);
                }
                updateStats();
            } catch (error) {
                stats.errorCount++;
                updateStats();
                
                const errorDetails = logError('ä¸€é”®æµ‹è¯•å¼‚å¸¸', error, {
                    fileInfo: {
                        name: file.name,
                        size: file.size,
                        type: file.type
                    },
                    requestParams: {
                        summaryId: summaryId,
                        courseId: courseId
                    },
                    errorType: error.constructor.name
                });
                
                showResult('quickTestResult', {
                    success: false,
                    error: error.message,
                    errorDetails: errorDetails
                }, true);
            } finally {
                quickTestBtn.disabled = false;
                quickTestBtn.textContent = 'ğŸš€ ä¸Šä¼ å¹¶è½¬æ–‡å­—ï¼ˆä¸€é”®æµ‹è¯•ï¼‰';
            }
        }

        // å¤„ç†ç™¾åº¦è¯­éŸ³è¯†åˆ«æ–‡ä»¶é€‰æ‹©
        function handleBaiduFileSelect() {
            const fileInput = document.getElementById('baiduAudioFile');
            const fileInfoDiv = document.getElementById('baiduFileInfo');
            const audioPreviewDiv = document.getElementById('baiduAudioPreview');
            const displayNameDiv = document.getElementById('baiduFileDisplayName');
            
            if (fileInput.files[0]) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                displayNameDiv.textContent = `âœ… å·²é€‰æ‹©: ${file.name} (${fileSize} MB)`;
                
                fileInfoDiv.style.display = 'block';
                fileInfoDiv.innerHTML = `
                    <strong>æ–‡ä»¶ä¿¡æ¯:</strong><br>
                    æ–‡ä»¶å: ${file.name}<br>
                    æ–‡ä»¶å¤§å°: ${fileSize} MB<br>
                    æ–‡ä»¶ç±»å‹: ${file.type || 'æœªçŸ¥'}<br>
                    æœ€åä¿®æ”¹: ${new Date(file.lastModified).toLocaleString()}
                `;
                
                // å¦‚æœæ˜¯éŸ³é¢‘æ–‡ä»¶ï¼Œæ˜¾ç¤ºé¢„è§ˆ
                if (file.type.startsWith('audio/')) {
                    const audioUrl = URL.createObjectURL(file);
                    audioPreviewDiv.style.display = 'block';
                    audioPreviewDiv.innerHTML = `
                        <strong>éŸ³é¢‘é¢„è§ˆ:</strong><br>
                        <audio controls src="${audioUrl}"></audio>
                    `;
                } else {
                    audioPreviewDiv.style.display = 'none';
                }
            } else {
                displayNameDiv.textContent = 'ğŸ“ ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ (.mp3, .wav, .m4a, .webm, .ogg)';
                fileInfoDiv.style.display = 'none';
                audioPreviewDiv.style.display = 'none';
            }
        }

        // 3. Whisper è¯­éŸ³è½¬æ–‡å­—ï¼ˆæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼‰
        async function processAudioToText() {
            const summaryId = document.getElementById('transcriptSummaryId').value;
            const audioFilePath = document.getElementById('transcriptAudioPath').value;

            if (!summaryId) {
                showResult('transcriptResult', 'è¯·è¾“å…¥è¯¾å ‚æ€»ç»“ID', true);
                return;
            }

            if (!audioFilePath) {
                showResult('transcriptResult', 'è¯·è¾“å…¥éŸ³é¢‘æ–‡ä»¶æœ¬åœ°è·¯å¾„', true);
                return;
            }

            const data = {
                summaryId: parseInt(summaryId),
                audioFilePath: audioFilePath
            };

            console.log('========== Whisper è¯­éŸ³è½¬æ–‡å­— ==========');
            console.log('è¯·æ±‚å‚æ•°:', data);
            console.log('================================');

            const processBtn = document.getElementById('whisperProcessBtn');
            showResult('transcriptResult', null, false, true);
            processBtn.disabled = true;
            processBtn.textContent = 'â³ Whisper å¤„ç†ä¸­ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...';

            try {
                const result = await makeRequest(BASE_URL + '/process-audio', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    const transcriptText = result.data?.data || '';
                    showResult('transcriptResult', {
                        success: true,
                        message: 'Whisper è¯­éŸ³è½¬æ–‡å­—æˆåŠŸ',
                        summaryId: summaryId,
                        audioFilePath: audioFilePath,
                        transcriptText: transcriptText,
                        transcriptLength: transcriptText.length,
                        responseTime: result.responseTime + 'ms',
                        fullResponse: result.data
                    });
                    
                    // å¦‚æœè½¬å½•æˆåŠŸï¼Œæ›´æ–°è½¬å½•æ–‡æœ¬è¾“å…¥æ¡†
                    if (transcriptText) {
                        document.getElementById('aiTranscriptText').value = transcriptText;
                        console.log('âœ… è½¬å½•æ–‡æœ¬å·²æ›´æ–°åˆ° AI ç”Ÿæˆè¾“å…¥æ¡†');
                    }
                } else {
                    const errorDetails = result.errorDetails || {
                        error: result.error,
                        status: result.status
                    };
                    showResult('transcriptResult', {
                        success: false,
                        error: result.error || 'Whisper å¤„ç†å¤±è´¥',
                        summaryId: summaryId,
                        audioFilePath: audioFilePath,
                        data: result.data,
                        errorDetails: errorDetails
                    }, true);
                }
            } catch (error) {
                const errorDetails = logError('Whisper è¯­éŸ³è½¬æ–‡å­—å¼‚å¸¸', error, {
                    summaryId: summaryId,
                    audioFilePath: audioFilePath,
                    errorType: error.constructor.name
                });
                
                showResult('transcriptResult', {
                    success: false,
                    error: error.message,
                    errorDetails: errorDetails
                }, true);
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = 'ğŸ¤ å¼€å§‹ Whisper è¯­éŸ³è½¬æ–‡å­—';
            }
        }

        // 3.5. ç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼ˆä¸Šä¼ åˆ°OSSåè½¬æ–‡å­—ï¼‰
        async function processBaiduSpeechToText() {
            const fileInput = document.getElementById('baiduAudioFile');
            const summaryId = document.getElementById('baiduSummaryId').value;
            const courseId = document.getElementById('baiduCourseId').value;
            const resultDiv = document.getElementById('baiduResult');
            const processBtn = document.getElementById('baiduProcessBtn');
            
            if (!fileInput.files[0]) {
                showResult('baiduResult', 'è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶', true);
                return;
            }

            if (!summaryId) {
                showResult('baiduResult', 'è¯·è¾“å…¥è¯¾å ‚æ€»ç»“ID', true);
                return;
            }

            if (!courseId) {
                showResult('baiduResult', 'è¯·è¾“å…¥è¯¾ç¨‹ID', true);
                return;
            }

            const file = fileInput.files[0];
            
            showResult('baiduResult', null, false, true);
            processBtn.disabled = true;
            processBtn.textContent = 'å¤„ç†ä¸­ï¼ˆä¸Šä¼ +è½¬æ–‡å­—ï¼‰...';

            try {
                // ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ éŸ³é¢‘æ–‡ä»¶åˆ°OSS
                console.log('========== æ­¥éª¤1: ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶åˆ°OSS ==========');
                const formData = new FormData();
                formData.append('audioFile', file);
                formData.append('courseId', courseId);
                formData.append('summaryId', summaryId);

                const uploadStartTime = Date.now();
                stats.totalRequests++;
                updateStats();

                console.log('æ–‡ä»¶ä¿¡æ¯:', {
                    name: file.name,
                    size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                    type: file.type
                });

                const uploadResponse = await fetch(`${BASE_URL}/upload-audio`, {
                    method: 'POST',
                    body: formData
                });

                const uploadEndTime = Date.now();
                const uploadResponseTime = uploadEndTime - uploadStartTime;
                stats.responseTimes.push(uploadResponseTime);

                let uploadData;
                try {
                    const text = await uploadResponse.text();
                    uploadData = JSON.parse(text);
                } catch (parseError) {
                    throw new Error('è§£æä¸Šä¼ å“åº”å¤±è´¥: ' + parseError.message);
                }

                if (!uploadResponse.ok) {
                    throw new Error('ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¤±è´¥: ' + (uploadData.msg || uploadResponse.statusText));
                }

                // è·å–éŸ³é¢‘URLï¼ˆä»è¿”å›çš„æ–‡ä»¶è·¯å¾„æ„å»ºå®Œæ•´URLï¼‰
                let audioUrl = uploadData.data;
                if (!audioUrl.startsWith('http://') && !audioUrl.startsWith('https://')) {
                    // å¦‚æœè¿”å›çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ /uploads/audio/course21/xxx.mp3ï¼‰ï¼Œæ„å»ºå®Œæ•´URL
                    // æ³¨æ„ï¼šè¿™éœ€è¦ç¡®ä¿æ–‡ä»¶å¯ä»¥é€šè¿‡ HTTP è®¿é—®ï¼Œæˆ–è€…éœ€è¦ä¸Šä¼ åˆ° OSS
                    if (audioUrl.startsWith('/')) {
                        // æ„å»ºå®Œæ•´çš„è®¿é—®URLï¼ˆå‡è®¾åç«¯æœåŠ¡åœ¨ localhost:8080ï¼‰
                        const baseUrl = window.location.origin.replace(/:\d+$/, ':8080');
                        audioUrl = baseUrl + audioUrl;
                        console.log('æ„å»ºçš„å®Œæ•´URL:', audioUrl);
                    } else {
                        throw new Error('æ— æ³•å¤„ç†è¿”å›çš„æ–‡ä»¶è·¯å¾„æ ¼å¼: ' + audioUrl);
                    }
                }

                console.log('========== ä¸Šä¼ æˆåŠŸ ==========');
                console.log('OSSè·¯å¾„/URL:', audioUrl);
                console.log('ä¸Šä¼ è€—æ—¶:', uploadResponseTime + 'ms');

                // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨OSS URLè¿›è¡Œè¯­éŸ³è½¬æ–‡å­—
                console.log('========== æ­¥éª¤2: ä½¿ç”¨ç™¾åº¦è¯­éŸ³è¯†åˆ«è½¬æ–‡å­— ==========');
                console.log('éŸ³é¢‘URL:', audioUrl);
                console.log('æ€»ç»“ID:', summaryId);

                const sttStartTime = Date.now();
                stats.totalRequests++;
                updateStats();

                const sttResult = await makeRequest(BASE_URL + '/process-audio', {
                    method: 'POST',
                    body: JSON.stringify({
                        summaryId: parseInt(summaryId),
                        audioUrl: audioUrl
                    })
                });

                const sttEndTime = Date.now();
                const totalTime = sttEndTime - uploadStartTime;

                if (sttResult.success) {
                    stats.successCount++;
                    console.log('========== è¯­éŸ³è½¬æ–‡å­—æˆåŠŸ ==========');
                    console.log('æ€»è€—æ—¶:', totalTime + 'ms');
                    
                    const transcriptText = sttResult.data?.data || '';
                    showResult('baiduResult', {
                        success: true,
                        message: 'å¤„ç†æˆåŠŸï¼ˆä¸Šä¼ +è½¬æ–‡å­—ï¼‰',
                        uploadTime: uploadResponseTime + 'ms',
                        sttTime: (sttEndTime - sttStartTime) + 'ms',
                        totalTime: totalTime + 'ms',
                        audioUrl: audioUrl,
                        transcriptText: transcriptText,
                        transcriptLength: transcriptText.length,
                        fullResponse: sttResult.data
                    });
                    
                    // æ›´æ–°è½¬å½•æ–‡æœ¬è¾“å…¥æ¡†
                    if (transcriptText) {
                        document.getElementById('aiTranscriptText').value = transcriptText;
                    }
                    
                    // æ›´æ–°URLè¾“å…¥æ¡†ï¼Œæ–¹ä¾¿åç»­æµ‹è¯•
                    document.getElementById('audioUrl').value = audioUrl;
                } else {
                    stats.errorCount++;
                    showResult('baiduResult', {
                        success: false,
                        error: 'è¯­éŸ³è½¬æ–‡å­—å¤±è´¥',
                        uploadSuccess: true,
                        audioUrl: audioUrl,
                        uploadTime: uploadResponseTime + 'ms',
                        sttError: sttResult.error || 'æœªçŸ¥é”™è¯¯',
                        sttResponse: sttResult.data,
                        errorDetails: sttResult.errorDetails
                    }, true);
                }
                updateStats();
            } catch (error) {
                stats.errorCount++;
                updateStats();
                
                const errorDetails = logError('ç™¾åº¦è¯­éŸ³è¯†åˆ«å¤„ç†å¼‚å¸¸', error, {
                    fileInfo: {
                        name: file.name,
                        size: file.size,
                        type: file.type
                    },
                    requestParams: {
                        summaryId: summaryId,
                        courseId: courseId
                    },
                    errorType: error.constructor.name
                });
                
                showResult('baiduResult', {
                    success: false,
                    error: error.message,
                    errorDetails: errorDetails
                }, true);
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = 'ä¸Šä¼ å¹¶è½¬æ–‡å­—ï¼ˆç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼‰';
            }
        }

        // 3.6. ä½¿ç”¨å·²æœ‰OSS URLè¿›è¡Œè¯­éŸ³è½¬æ–‡å­—
        async function processAudioFromUrl() {
            const summaryId = document.getElementById('urlSummaryId').value;
            const audioUrl = document.getElementById('audioUrl').value;

            if (!summaryId) {
                showResult('urlResult', 'è¯·è¾“å…¥è¯¾å ‚æ€»ç»“ID', true);
                return;
            }

            if (!audioUrl) {
                showResult('urlResult', 'è¯·è¾“å…¥OSSéŸ³é¢‘URL', true);
                return;
            }

            if (!audioUrl.startsWith('http://') && !audioUrl.startsWith('https://')) {
                showResult('urlResult', 'éŸ³é¢‘URLæ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»ä»¥ http:// æˆ– https:// å¼€å¤´', true);
                return;
            }

            console.log('========== ä½¿ç”¨OSS URLè¿›è¡Œè¯­éŸ³è½¬æ–‡å­— ==========');
            console.log('æ€»ç»“ID:', summaryId);
            console.log('éŸ³é¢‘URL:', audioUrl);
            console.log('================================');

            showResult('urlResult', null, false, true);
            const urlProcessBtn = document.getElementById('urlProcessBtn');
            urlProcessBtn.disabled = true;
            urlProcessBtn.textContent = 'è½¬æ–‡å­—ä¸­...';

            try {
                const result = await makeRequest(BASE_URL + '/process-audio', {
                    method: 'POST',
                    body: JSON.stringify({
                        summaryId: parseInt(summaryId),
                        audioUrl: audioUrl
                    })
                });

                if (result.success) {
                    const transcriptText = result.data?.data || '';
                    showResult('urlResult', {
                        success: true,
                        message: 'è¯­éŸ³è½¬æ–‡å­—æˆåŠŸ',
                        audioUrl: audioUrl,
                        transcriptText: transcriptText,
                        transcriptLength: transcriptText.length,
                        responseTime: result.responseTime + 'ms',
                        fullResponse: result.data
                    });
                    
                    // æ›´æ–°è½¬å½•æ–‡æœ¬è¾“å…¥æ¡†
                    if (transcriptText) {
                        document.getElementById('aiTranscriptText').value = transcriptText;
                    }
                } else {
                    showResult('urlResult', {
                        success: false,
                        error: result.error || 'è½¬æ–‡å­—å¤±è´¥',
                        audioUrl: audioUrl,
                        response: result.data,
                        errorDetails: result.errorDetails
                    }, true);
                }
            } catch (error) {
                const errorDetails = logError('ä½¿ç”¨URLè½¬æ–‡å­—å¼‚å¸¸', error, {
                    summaryId: summaryId,
                    audioUrl: audioUrl,
                    errorType: error.constructor.name
                });
                
                showResult('urlResult', {
                    success: false,
                    error: error.message,
                    errorDetails: errorDetails
                }, true);
            } finally {
                urlProcessBtn.disabled = false;
                urlProcessBtn.textContent = 'ä½¿ç”¨URLè½¬æ–‡å­—';
            }
        }

        // 4. AIç”Ÿæˆé‡ç‚¹æ•´ç†
        async function generateAISummary() {
            const data = {
                summaryId: parseInt(document.getElementById('aiSummaryId').value),
                transcriptText: document.getElementById('aiTranscriptText').value,
                coursewareContent: document.getElementById('aiCoursewareContent').value
            };

            console.log('========== AIç”Ÿæˆé‡ç‚¹æ•´ç† ==========');
            console.log('è¯·æ±‚å‚æ•°:', {
                summaryId: data.summaryId,
                transcriptTextLength: data.transcriptText?.length || 0,
                coursewareContentLength: data.coursewareContent?.length || 0
            });
            console.log('================================');

            showResult('aiResult', null, false, true);
            const result = await makeRequest(BASE_URL + '/generate-summary', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result.success) {
                showResult('aiResult', result.data);
            } else {
                const errorDetails = result.errorDetails || {
                    error: result.error,
                    status: result.status
                };
                showResult('aiResult', {
                    success: false,
                    error: result.error || 'ç”Ÿæˆå¤±è´¥',
                    data: result.data,
                    errorDetails: errorDetails
                }, true);
            }
        }

        // 5. è·å–æ•™å¸ˆè¯¾å ‚æ€»ç»“åˆ—è¡¨
        async function getTeacherSummaries() {
            const teacherId = document.getElementById('listTeacherId').value;

            console.log('========== è·å–æ•™å¸ˆè¯¾å ‚æ€»ç»“åˆ—è¡¨ ==========');
            console.log('æ•™å¸ˆID:', teacherId);
            console.log('================================');

            showResult('listResult', null, false, true);
            const result = await makeRequest(BASE_URL + `/teacher/${teacherId}`, {
                method: 'GET'
            });

            if (result.success) {
                showResult('listResult', result.data);
            } else {
                const errorDetails = result.errorDetails || {
                    error: result.error,
                    status: result.status
                };
                showResult('listResult', {
                    success: false,
                    error: result.error || 'è·å–å¤±è´¥',
                    data: result.data,
                    errorDetails: errorDetails
                }, true);
            }
        }

        // 6. æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ä¿¡æ¯
        async function testAudioFile() {
            const summaryId = document.getElementById('testSummaryId').value;

            console.log('========== æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ä¿¡æ¯ ==========');
            console.log('è¯¾å ‚æ€»ç»“ID:', summaryId);
            console.log('================================');

            showResult('testResult', null, false, true);
            const result = await makeRequest(BASE_URL + `/test-audio/${summaryId}`, {
                method: 'GET'
            });

            if (result.success) {
                showResult('testResult', result.data);
            } else {
                const errorDetails = result.errorDetails || {
                    error: result.error,
                    status: result.status
                };
                showResult('testResult', {
                    success: false,
                    error: result.error || 'æµ‹è¯•å¤±è´¥',
                    data: result.data,
                    errorDetails: errorDetails
                }, true);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            console.log('è¯¾å ‚æ€»ç»“éŸ³é¢‘ä¸Šä¼ APIæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>
